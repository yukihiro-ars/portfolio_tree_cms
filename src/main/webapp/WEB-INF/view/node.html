<!DOCTYPE html>
<html lang="ja"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymleaf.org">
<head th:replace="fragment/head :: head_fragment(title = 'Node画面', scripts = ~{::script})")>
    <script th:inline="javascript">
        /** TODO contents 画面と共通化 */
        function doPost() {
            $.ajax({
                url : $("#nodeForm").attr("action"),
                method : $("#nodeForm").attr("method"),
                data : $("#nodeForm").serialize(),
                contentType : "application/x-www-form-urlencoded",
                beforeSend : function () {
                    $(".errorMsg").remove();
                }
            }).done(function() {
                // TODO 処理成功時のメッセージ
                console.log(arguments);
                alert("success!!");
            }).error(function(jqXHR) {
                // エラーメッセージ出力
                if (jqXHR && jqXHR.responseJSON) {
                    Object.keys(jqXHR.responseJSON)
                        .map(function(elm, idx, arr) {
                            $("#"+ elm).after(
                                "<span class='errorMsg'>"
                                + jqXHR.responseJSON[elm]
                                + "</span>");
                        });
                    console.log(jqXHR.responseJSON);
                }
                alert("error!!");
            });
        };
    </script>
</head>
<body>
<h2>Node!</h2>
<div class="container">
    <form th:object="${nodeForm}" id="nodeForm" method="post" th:action="@{/node}">
        <div class="form-group">
            <!-- ノードID -->
            <label for="nodeId">ノードID：</label>
            <span th:text="*{nodeId}"/>
            <input th:field="*{nodeId}" type="hidden" class="form-control"/>
        </div>
        <div class="form-group">
            <!-- ノード種別 -->
            <label for="nodeType">ノード種別</label>
            <select id="nodeType" name="nodeType" class="form-control">
                <option th:each="nt : ${T(ars.yukihiro.constants.NodeType).values()}"
                        th:value="${nt.name}"
                        th:selected="${nt.value}==*{nodeType.value}"
                        th:text="${nt.label}"></option>
            </select>
        </div>
        <div class="form-group">
            <!-- 階層 -->
            <label for="hierarchy">階層</label>
            <input th:field="*{hierarchy}" type="text" class="form-control"/>
        </div>
        <div class="form-group">
            <!-- ノード名（論理） -->
            <label for="nodeNmLgc">ノード名（論理）</label>
            <input th:field="*{nodeNmLgc}" type="text" class="form-control"/>
        </div>

        <div class="form-group">
            <!-- ノード名（物理） -->
            <label for="nodeNmPsc">ノード名（物理）</label>
            <input th:field="*{nodeNmPsc}" type="text" class="form-control"/>
        </div>

        <!-- TODO コンテンツID modelから候補取得 -->
        <!-- TODO 隠し項目　登録日付、更新日付 -->
        <!-- TODO 登録 / 更新 名称切り替え -->
        <button type="button" class="btn btn-outline-primary" onclick="doPost()">登録/更新</button>
    </form>
</div>
</body>
</html>
